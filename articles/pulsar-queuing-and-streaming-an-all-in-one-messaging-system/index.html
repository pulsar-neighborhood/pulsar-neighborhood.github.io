<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Pulsar: Queuing and Streaming - An All in One Messaging System - Pulsar Neighborhood</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Pulsar Neighborhood community enables Apache Pulsar users and developers to learn about Pulsar and how to use it in their professional lives; via useful, interactive content (including blogs, Meetups, and YouTube videos). This is all driven by a passionate, vendor neutral, and inclusive community of members."><meta property="og:title" content="The Pulsar Neighborhood"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pulsar-neighborhood.io"><meta property="og:image" content="https://www.pulsar-neighborhood.io/png/blue-logotype.png"><meta property="og:description" content="The Pulsar Neighborhood community enables Apache Pulsar users and developers to learn about Pulsar and how to use it in their professional lives; via useful, interactive content (including blogs, Meetups, and YouTube videos). This is all driven by a passionate, vendor neutral, and inclusive community of members."><meta name=twitter:site content="@pulsar_neighbor"><meta name=twitter:creator content="@pulsar_neighbor"><link rel=alternate type=application/rss+xml href=/index.xml title="Site Title"><meta name=google-site-verification content="m-1Z-0k0EvG9PD7R24pKuETSaBpEvqoXgOYT-0MtuPU"><link rel=icon href=https://www.pulsar-neighborhood.io/favicon.png><link rel=canonical href=https://www.pulsar-neighborhood.io/articles/pulsar-queuing-and-streaming-an-all-in-one-messaging-system/><link rel=stylesheet href=/css/style.32ad96ee983b063b549f59db931afb8f0db25424bf2d687e1122748a7d183f73.css><style>.ctct-form-defaults{padding:15px!important}</style><script type=application/ld+json>[{"@context":"http://schema.org","@type":"WebPage","name":"Pulsar Neighborhood - Pulsar: Queuing and Streaming - An All in One Messaging System","description":"I would also like to focus this reading on what is Pulsar and how it works under its own merits rather than comparing it against apache Kafka. I am taking this approach as there is plenty literature doing this already and because from a messaging system architecture both of these paradigms, up to a point, are different.","publisher":{"@type":"Organization","name":"Pulsar Neighborhood"}},{"@context":"http://schema.org","@type":"BlogPosting","image":"https://www.pulsar-neighborhood.io/images/blue-logotype.png","url":"https:\/\/www.pulsar-neighborhood.io\/articles\/pulsar-queuing-and-streaming-an-all-in-one-messaging-system\/","publisher":"Pulsar Neighborhood","headline":"Pulsar: Queuing and Streaming - An All in One Messaging System","dateCreated":"2022-03-22 15:03:42 -0400 -0400","datePublished":"2022-03-22 15:03:42 -0400 -0400","dateModified":"2022-03-22 15:03:42 -0400 -0400","inLanguage":"en-US","isFamilyFriendly":"true","copyrightYear":"2022","copyrightHolder":"","author":{"@type":"Person","name":"Ivan Garcia","url":"https://www.pulsar-neighborhood.io"},"mainEntityOfPage":"True","articleSection":["getting-started"],"articleBody":"\u003ch2 id=\u0022an-all-in-one-messaging-system\u0022\u003eAn All In One Messaging System\u003c\/h2\u003e\n\u003chr\u003e\n\u003ch4 id=\u0022-ivan-garcia---feb-2022---15-min-read\u0022\u003e‚úèÔ∏è Ivan Garcia \/ üìÜ Feb 2022 \/ üïë 15 min read\u003c\/h4\u003e\n\u003ch4 id=\u0022httpsgithubcomivangdrpulsar-queuing-and-streaming\u0022\u003e\u003ca href=\u0022https:\/\/github.com\/IvanGDR\/Pulsar-Queuing-and-Streaming\u0022 target=\u0022_blank\u0022\u003ehttps:\/\/github.com\/IvanGDR\/Pulsar-Queuing-and-Streaming\u003c\/a\u003e\u003c\/h4\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIn this first delivery of this blog series over apache Pulsar, the aim is to provide an introductory reading about this topic.\nI would also like to focus this reading on what is Pulsar and how it works under its own merits rather than comparing it against apache Kafka. I am taking this approach as there is plenty literature doing this already and because from a messaging system architecture both of these paradigms, up to a point, are different.\u003c\/p\u003e\n\u003c\/blockquote\u003e\n\u003ch2 id=\u0022what-is-apache-pulsar\u0022\u003eWhat is Apache Pulsar?\u003c\/h2\u003e\n\u003cp\u003eApache Pulsar is an open-source distributed publish-subscrib messaging system with a robust, highly available, high performance streaming messaging platform, offering messaging \u003cstrong\u003econsumption\u003c\/strong\u003e, \u003cstrong\u003eacknowledging\u003c\/strong\u003e and \u003cstrong\u003eretention\u003c\/strong\u003e facilities as well as \u003cstrong\u003etenant implementation\u003c\/strong\u003e options.\u003c\/p\u003e\n\u003ch2 id=\u0022tenant-implementation\u0022\u003e\u003cstrong\u003eTenant Implementation\u003c\/strong\u003e\u003c\/h2\u003e\n\u003cp\u003eOn a high level view, Apache Pulsar has been conceived to support multi-tenant deployments. The key pieces that allows this configuration topology are: \u003cstrong\u003eproperties\u003c\/strong\u003e and \u003cstrong\u003enamespaces\u003c\/strong\u003e.\u003c\/p\u003e\n\u003cpre tabindex=\u00220\u0022\u003e\u003ccode\u003e!!! An analogy for this would be:\nPulsar Cluster(s) = Company (Regional Branches)\nPropert(y\/ies)    = Department(s)\nNamespace(s)      = Operative action(s)\n\u003c\/code\u003e\u003c\/pre\u003e\u003cp\u003e\u003cimg src=\u0022https:\/\/user-images.githubusercontent.com\/67383481\/154675909-bac357fe-895e-444b-8727-e120ca1ed2bc.png\u0022 alt=\u0022 Apache Pulsar tenant facilities\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eFig. 1: Apache Pulsar tenant facilities.\u003c\/p\u003e\n\u003ch2 id=\u0022message-consumption\u0022\u003e\u003cstrong\u003eMessage Consumption\u003c\/strong\u003e\u003c\/h2\u003e\n\u003cp\u003eIn a lower level view, the Apache Pulsar Model is based on the following components:\u003c\/p\u003e\n\u003cp\u003eProducer -\u0026gt; Topic \u0026lt;\u0026ndash;\u0026gt; Subscription \u0026lt;- Consumer\u003c\/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. Producer:\u003c\/strong\u003e It is the application that sends messages to the topic and each message sent by the publisher is only stored once on a topic partition. It uses a Routing to determine which internal topic a message should be published to.\u003c\/p\u003e\n\u003cp\u003e\u003cstrong\u003e2. Topic (partition):\u003c\/strong\u003e It is the place where all the messages arrive. Each topic partition (stateless) is backed by a distributed log stored in Apache BookKeeper (stateful). The partition is the core resource in Pulsar, that performs the critical administrative operations inherited from the namespace in which it resides. Furthermore these namespaces can have a local or global scope. By default Pulsar Topics are created as non-partitioned but this can be modified to obtain high throughput to manage big data. As Producers and consumers are partition agnostic, a non-partitioned topic can be converted into partitioned on the fly (modifying the BROKER process), it is a pure administrative task.\u003c\/p\u003e\n\u003cp\u003e\u003cstrong\u003e3. Subscription:\u003c\/strong\u003e Determines which consumer(s) a message should be delivered to. Each topic can have multiple subscriptions and a subscription can have one or more consumer group(s). There are three types of subscriptions that can co-exist on the same topic:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eExclusive Subscription: For \u003cem\u003e\u003cstrong\u003estreaming\u003c\/strong\u003e\u003c\/em\u003e use case. One consumer only in order to respect ordered consumption.\u003c\/li\u003e\n\u003cli\u003eFailover Subscription: For \u003cem\u003e\u003cstrong\u003estreaming\u003c\/strong\u003e\u003c\/em\u003e use case. Two consumers but one active only in order to respect ordered consumption.\u003c\/li\u003e\n\u003cli\u003eShared Subscription: For \u003cem\u003e\u003cstrong\u003equeuing\u003c\/strong\u003e\u003c\/em\u003e use case. Multiple consumers can be active, allowing consumption in an unordered manner.\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003e\u003cstrong\u003e4. Consumer:\u003c\/strong\u003e It is the application that reads messages from Pulsar. These are grouped together for consuming messages. Each consumer group can have its own way of consuming the messages.\u003c\/p\u003e\n\u003cp\u003e\u003cimg src=\u0022%22https:\/\/user-images.githubusercontent.com\/67383481\/154716613-59cbf35e-cf4f-45ff-bc58-69478348b31e.png\u0022 alt=\u0022Apache Pulsar Model and Message Consumption\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eFig. 2: Apache Pulsar Model and Message Consumption\u003c\/p\u003e\n\u003ch2 id=\u0022message-acknowledgement\u0022\u003e\u003cstrong\u003eMessage Acknowledgement\u003c\/strong\u003e\u003c\/h2\u003e\n\u003cp\u003eThese implementation policies apply in case there is a system failure situation and message(s) cannot be delivered in time.\u003c\/p\u003e\n\u003cp\u003ePulsar provides both \u003cstrong\u003ecumulative\u003c\/strong\u003e acknowledgment and \u003cstrong\u003eindividual\u003c\/strong\u003e acknowledgment. In cumulative acknowledgement, any message before the acknowledged message will not be redelivered or consumed again. In individual acknowledgment, only the messages marked as acknowledged will not be redelivered in the case of failure.\u003c\/p\u003e\n\u003cp\u003eFor both exclusive or failover subscriptions (streaming) cumulative or individual acknowledge can be applied. For shared subscription (queuing) only individual acknowledge is applicable.\u003c\/p\u003e\n\u003cp\u003e\u003cimg src=\u0022https:\/\/user-images.githubusercontent.com\/67383481\/154717167-c0d6053a-60e3-4416-bc38-9e5ba0323bd3.png\u0022 alt=\u0022Cumulative (above) vs Individual (below) Message Acknowledgment, blue cells will be redelivered\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eFig. 3: Cumulative (above) vs Individual (below) Message Acknowledgment, blue cells will be redelivered.\u003c\/p\u003e\n\u003ch2 id=\u0022message-retention-and-time-to-live-ttl-policies\u0022\u003e\u003cstrong\u003eMessage Retention and Time To Live (TTL) Policies\u003c\/strong\u003e\u003c\/h2\u003e\n\u003cp\u003eA Pulsar cluster consists of 2 fundamental layers: a set of brokers as a serving layer, and a set of bookie nodes as a persistent storage layer. The Brokers as stateless components handle the partitioned parts of topics: store the received messages to the cluster, retrieve messages from the cluster, and send to the consumers on demand. The physical storage of the messages is handled by ‚Äúbookie‚Äù nodes, which are the persistent storage for the Pulsar cluster. The Apache BookKeeper is the configuration used to manage bookie nodes. Since the broker layer and bookie layer are separated, scaling one layer is independent of scaling the other.\u003c\/p\u003e\n\u003cp\u003eHaving said that, in Pulsar, messages can only be deleted after all the subscriptions have already consumed it (the messages are marked as acknowledged in their cursors). However, Pulsar also allows to keep messages for a longer time even after all subscriptions have already consumed them. This is done by configuring a message retention period.\nAdditionally, Pulsar allows TTL, a message will automatically be marked as acknowledged if it is not consumed by any consumers within the configured TTL time period.\u003c\/p\u003e\n\u003cp\u003e\u003cimg src=\u0022https:\/\/user-images.githubusercontent.com\/67383481\/154717370-aa95330b-c0ac-4171-b500-5d8c6b3120a7.png\u0022 alt=\u0022Pulsar message retention policies\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eFig. 4: Pulsar message retention policies.\u003c\/p\u003e\n\u003cpre tabindex=\u00220\u0022\u003e\u003ccode\u003e!!! Fig 4 interpretation\nFigure 4 shows how retention policies work with and without retention policy in place in a topic partition.\nWithout retention policy, Grey cells can be deleted as these have been acknowledged by subscriptions A and B. \nBlue cells cannot be deleted yet as not acknowledged by subscription A. \nGreen cells cannot be deleted as not acknowledged by any subscription.\n\nUsing retention policy, only grey cells can be marked as retained, for the configured time period, as both \nsubscription A and B have consumed those messages.\n\nOn this topic partition subscription B has a TTL in place, cell M10 has been marked as acknowledged even if\nthis cell has not been consumed yet.\n\u003c\/code\u003e\u003c\/pre\u003e\u003ch2 id=\u0022pulsar-arquitecture\u0022\u003e\u003cstrong\u003ePulsar Arquitecture\u003c\/strong\u003e\u003c\/h2\u003e\n\u003cp\u003eIn order to configure a highly available Pulsar multicluster, the following is required:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eA zookeeper ensemble (Local Zk for Pulsar and Bookeeper metadata and Global Zk for Store multicluster metadata)\u003c\/li\u003e\n\u003cli\u003eA Bookeeper cluster (Stateful storage layer)\u003c\/li\u003e\n\u003cli\u003eA Pulsar broker cluster (Stateless coordinator)\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003e\u003cimg src=\u0022https:\/\/user-images.githubusercontent.com\/67383481\/154717565-1270b79e-352f-4a89-a051-5ccec5037926.png\u0022 alt=\u0022Pulsar architecture stack\u0022\u003e\u003c\/p\u003e\n\u003cp\u003eFig. 5: Pulsar architecture stack.\u003c\/p\u003e\n\u003ch2 id=\u0022conclusion\u0022\u003eConclusion\u003c\/h2\u003e\n\u003cp\u003eIn this first part of a trio blog, I reviewed the principal concepts of Apache Pulsar, briefly considering a high and low level description and highlighting the main benefits that it offers, as for example, robust unified messaging system, streaming and queuing paradigms support, multi tenancy facilities, geo replication, retention policies, high availability and big data performance amongst others.\nIn my next blogs I will walk through the installation of a high available Pulsar cluster and finally conclude the blog series with an overview of the logs location and analysis as an attempt to understand how the stack is being built up in order to troubleshoot and solve any potential connection problem that may happen within one or more of the components that Pulsar utilises.\u003c\/p\u003e\n"}]</script></head><body class='page bg-secondary'><div id=main-menu-mobile class=main-menu-mobile><ul></ul></div><div class=wrapper><div class='header sticky-top bg-secondary'><div class=container><div class=logo><a href=https://www.pulsar-neighborhood.io><img src=/svg/Pulsar-Neighborhood-Logo.svg class=img-fluid></a></div><div class=logo-mobile><a href=https://www.pulsar-neighborhood.io><img src=/svg/Neighborhood-Icon.svg class=img-fluid></a></div><div id=main-menu class=main-menu><ul><li><a href=/about><span>About The Pulsar Neighborhood</span></a></li><li><a href=https://pulsar.apache.org/ target=_blank><span>About Apache Pulsar</span></a></li><li><a href=https://pulsar.apache.org/docs/en/standalone/ target=_blank><span></span>Project Documentation</span></a></li><li><a href=/index.xml><img src=/svg/square-rss-solid.svg title="Subscribe to The Pulsar Neighborhood feed" class=img-fluid style=height:30px></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pb-3"><div class=row><div class="col-0 col-md-2"><div class=sidebar><div class=mb-2><a href=/guides/getting-started><div class="col-12 btn btn-success">Get Started with Pulsar</div></a></div><div class="spotlight mb-2 border border-primary rounded"><div class="row bg-primary no-gutters"><div class="col-12 text-secondary p-1">&nbsp;Find Articles and Guides</div></div><div class=p-1><div class="row no-gutters"><div class="col-12 mb-1"><h4>Level</h4><ul><li><input class=form-check-input type=checkbox id=100 onclick=toggleFilter(filterOptions.levelFilters,this.id)><label class=form-check-label for=100>&nbsp;Beginner (100)</label></li><li><input class=form-check-input type=checkbox id=200 onclick=toggleFilter(filterOptions.levelFilters,this.id)><label class=form-check-label for=200>&nbsp;Intermediate (200)</label></li><li><input class=form-check-input type=checkbox id=300 onclick=toggleFilter(filterOptions.levelFilters,this.id)><label class=form-check-label for=300>&nbsp;Advanced (300)</label></li></ul></div><div class="row no-gutters"><div class=col-12><h4>Category</h4><ul><li><input class=form-check-input type=checkbox id=at-the-edge onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=at-the-edge>&nbsp;At the Edge [3]</label></li><li><input class=form-check-input type=checkbox id=cluster-administration onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=cluster-administration>&nbsp;Cluster Administration [2]</label></li><li><input class=form-check-input type=checkbox id=getting-started onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=getting-started>&nbsp;Getting Started [13]</label></li><li><input class=form-check-input type=checkbox id=machine-learning onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=machine-learning>&nbsp;Machine Learning [2]</label></li><li><input class=form-check-input type=checkbox id=moving-to-pulsar onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=moving-to-pulsar>&nbsp;Moving to Pulsar [8]</label></li><li><input class=form-check-input type=checkbox id=newsletter onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=newsletter>&nbsp;Newsletter [7]</label></li><li><input class=form-check-input type=checkbox id=project-news onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=project-news>&nbsp;Project News [3]</label></li><li><input class=form-check-input type=checkbox id=pulsar-architecture onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=pulsar-architecture>&nbsp;Pulsar Architecture [10]</label></li><li><input class=form-check-input type=checkbox id=pulsar-components onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=pulsar-components>&nbsp;Pulsar Components [7]</label></li><li><input class=form-check-input type=checkbox id=use-cases onclick=toggleFilter(filterOptions.categoryFilters,this.id)>
<label class=form-check-label for=use-cases>&nbsp;Use Cases [4]</label></li></ul></div></div></div></div></div></div></div><div class="col-12 col-md-8"><div class=container><header class=mb-3><div class=pb-2></div><h1>Pulsar: Queuing and Streaming - An All in One Messaging System</h1></header><div class="row mb-3 no-gutters border-top border-bottom"><div class=col-2><ul class="list-group list-group-horizontal mt-1 mb-1"><li class="list-group-item flex-fill border-0 p-0 mr-3"><a href="https://www.linkedin.com/sharing/share-offsite/?mini=true&url=https%3a%2f%2fwww.pulsar-neighborhood.io%2farticles%2fpulsar-queuing-and-streaming-an-all-in-one-messaging-system%2f&title=Pulsar%3a%20Queuing%20and%20Streaming%20-%20An%20All%20in%20One%20Messaging%20System" target=_blank><img src=/svg/linkedin-in-brands.svg title="Share this on LinkedIn" class=img-fluid></a></li><li class="list-group-item flex-fill border-0 p-0 mr-3"><a target=_blank href="https://twitter.com/intent/tweet?text=Pulsar%3a%20Queuing%20and%20Streaming%20-%20An%20All%20in%20One%20Messaging%20System&url=https%3a%2f%2fwww.pulsar-neighborhood.io%2farticles%2fpulsar-queuing-and-streaming-an-all-in-one-messaging-system%2f&hashtags=apachepulsar&via=pulsar_neighbor"><img src=/svg/twitter-brands.svg title="Share this on Twitter" class=img-fluid></a></li></ul></div><div class="col text-right"><span class=text-muted>Author:</span> Ivan Garcia<br><span class=text-muted>Published:</span> March 22, 2022</div></div><article><h2 id=an-all-in-one-messaging-system>An All In One Messaging System</h2><hr><h4 id=-ivan-garcia---feb-2022---15-min-read>‚úèÔ∏è Ivan Garcia / üìÜ Feb 2022 / üïë 15 min read</h4><h4 id=httpsgithubcomivangdrpulsar-queuing-and-streaming><a href=https://github.com/IvanGDR/Pulsar-Queuing-and-Streaming target=_blank>https://github.com/IvanGDR/Pulsar-Queuing-and-Streaming</a></h4><hr><blockquote><p>In this first delivery of this blog series over apache Pulsar, the aim is to provide an introductory reading about this topic.
I would also like to focus this reading on what is Pulsar and how it works under its own merits rather than comparing it against apache Kafka. I am taking this approach as there is plenty literature doing this already and because from a messaging system architecture both of these paradigms, up to a point, are different.</p></blockquote><h2 id=what-is-apache-pulsar>What is Apache Pulsar?</h2><p>Apache Pulsar is an open-source distributed publish-subscrib messaging system with a robust, highly available, high performance streaming messaging platform, offering messaging <strong>consumption</strong>, <strong>acknowledging</strong> and <strong>retention</strong> facilities as well as <strong>tenant implementation</strong> options.</p><h2 id=tenant-implementation><strong>Tenant Implementation</strong></h2><p>On a high level view, Apache Pulsar has been conceived to support multi-tenant deployments. The key pieces that allows this configuration topology are: <strong>properties</strong> and <strong>namespaces</strong>.</p><pre tabindex=0><code>!!! An analogy for this would be:
Pulsar Cluster(s) = Company (Regional Branches)
Propert(y/ies)    = Department(s)
Namespace(s)      = Operative action(s)
</code></pre><p><img src=https://user-images.githubusercontent.com/67383481/154675909-bac357fe-895e-444b-8727-e120ca1ed2bc.png alt=" Apache Pulsar tenant facilities"></p><p>Fig. 1: Apache Pulsar tenant facilities.</p><h2 id=message-consumption><strong>Message Consumption</strong></h2><p>In a lower level view, the Apache Pulsar Model is based on the following components:</p><p>Producer -> Topic &lt;&ndash;> Subscription &lt;- Consumer</p><p><strong>1. Producer:</strong> It is the application that sends messages to the topic and each message sent by the publisher is only stored once on a topic partition. It uses a Routing to determine which internal topic a message should be published to.</p><p><strong>2. Topic (partition):</strong> It is the place where all the messages arrive. Each topic partition (stateless) is backed by a distributed log stored in Apache BookKeeper (stateful). The partition is the core resource in Pulsar, that performs the critical administrative operations inherited from the namespace in which it resides. Furthermore these namespaces can have a local or global scope. By default Pulsar Topics are created as non-partitioned but this can be modified to obtain high throughput to manage big data. As Producers and consumers are partition agnostic, a non-partitioned topic can be converted into partitioned on the fly (modifying the BROKER process), it is a pure administrative task.</p><p><strong>3. Subscription:</strong> Determines which consumer(s) a message should be delivered to. Each topic can have multiple subscriptions and a subscription can have one or more consumer group(s). There are three types of subscriptions that can co-exist on the same topic:</p><ul><li>Exclusive Subscription: For <em><strong>streaming</strong></em> use case. One consumer only in order to respect ordered consumption.</li><li>Failover Subscription: For <em><strong>streaming</strong></em> use case. Two consumers but one active only in order to respect ordered consumption.</li><li>Shared Subscription: For <em><strong>queuing</strong></em> use case. Multiple consumers can be active, allowing consumption in an unordered manner.</li></ul><p><strong>4. Consumer:</strong> It is the application that reads messages from Pulsar. These are grouped together for consuming messages. Each consumer group can have its own way of consuming the messages.</p><p><img src=%22https://user-images.githubusercontent.com/67383481/154716613-59cbf35e-cf4f-45ff-bc58-69478348b31e.png alt="Apache Pulsar Model and Message Consumption"></p><p>Fig. 2: Apache Pulsar Model and Message Consumption</p><h2 id=message-acknowledgement><strong>Message Acknowledgement</strong></h2><p>These implementation policies apply in case there is a system failure situation and message(s) cannot be delivered in time.</p><p>Pulsar provides both <strong>cumulative</strong> acknowledgment and <strong>individual</strong> acknowledgment. In cumulative acknowledgement, any message before the acknowledged message will not be redelivered or consumed again. In individual acknowledgment, only the messages marked as acknowledged will not be redelivered in the case of failure.</p><p>For both exclusive or failover subscriptions (streaming) cumulative or individual acknowledge can be applied. For shared subscription (queuing) only individual acknowledge is applicable.</p><p><img src=https://user-images.githubusercontent.com/67383481/154717167-c0d6053a-60e3-4416-bc38-9e5ba0323bd3.png alt="Cumulative (above) vs Individual (below) Message Acknowledgment, blue cells will be redelivered"></p><p>Fig. 3: Cumulative (above) vs Individual (below) Message Acknowledgment, blue cells will be redelivered.</p><h2 id=message-retention-and-time-to-live-ttl-policies><strong>Message Retention and Time To Live (TTL) Policies</strong></h2><p>A Pulsar cluster consists of 2 fundamental layers: a set of brokers as a serving layer, and a set of bookie nodes as a persistent storage layer. The Brokers as stateless components handle the partitioned parts of topics: store the received messages to the cluster, retrieve messages from the cluster, and send to the consumers on demand. The physical storage of the messages is handled by ‚Äúbookie‚Äù nodes, which are the persistent storage for the Pulsar cluster. The Apache BookKeeper is the configuration used to manage bookie nodes. Since the broker layer and bookie layer are separated, scaling one layer is independent of scaling the other.</p><p>Having said that, in Pulsar, messages can only be deleted after all the subscriptions have already consumed it (the messages are marked as acknowledged in their cursors). However, Pulsar also allows to keep messages for a longer time even after all subscriptions have already consumed them. This is done by configuring a message retention period.
Additionally, Pulsar allows TTL, a message will automatically be marked as acknowledged if it is not consumed by any consumers within the configured TTL time period.</p><p><img src=https://user-images.githubusercontent.com/67383481/154717370-aa95330b-c0ac-4171-b500-5d8c6b3120a7.png alt="Pulsar message retention policies"></p><p>Fig. 4: Pulsar message retention policies.</p><pre tabindex=0><code>!!! Fig 4 interpretation
Figure 4 shows how retention policies work with and without retention policy in place in a topic partition.
Without retention policy, Grey cells can be deleted as these have been acknowledged by subscriptions A and B. 
Blue cells cannot be deleted yet as not acknowledged by subscription A. 
Green cells cannot be deleted as not acknowledged by any subscription.

Using retention policy, only grey cells can be marked as retained, for the configured time period, as both 
subscription A and B have consumed those messages.

On this topic partition subscription B has a TTL in place, cell M10 has been marked as acknowledged even if
this cell has not been consumed yet.
</code></pre><h2 id=pulsar-arquitecture><strong>Pulsar Arquitecture</strong></h2><p>In order to configure a highly available Pulsar multicluster, the following is required:</p><ul><li>A zookeeper ensemble (Local Zk for Pulsar and Bookeeper metadata and Global Zk for Store multicluster metadata)</li><li>A Bookeeper cluster (Stateful storage layer)</li><li>A Pulsar broker cluster (Stateless coordinator)</li></ul><p><img src=https://user-images.githubusercontent.com/67383481/154717565-1270b79e-352f-4a89-a051-5ccec5037926.png alt="Pulsar architecture stack"></p><p>Fig. 5: Pulsar architecture stack.</p><h2 id=conclusion>Conclusion</h2><p>In this first part of a trio blog, I reviewed the principal concepts of Apache Pulsar, briefly considering a high and low level description and highlighting the main benefits that it offers, as for example, robust unified messaging system, streaming and queuing paradigms support, multi tenancy facilities, geo replication, retention policies, high availability and big data performance amongst others.
In my next blogs I will walk through the installation of a high available Pulsar cluster and finally conclude the blog series with an overview of the logs location and analysis as an attempt to understand how the stack is being built up in order to troubleshoot and solve any potential connection problem that may happen within one or more of the components that Pulsar utilises.</p></article><div class="row border border-primary rounded"><div class="col p-2"><h3>You might also like...</h3><div class=row><div class="col text-center p-2"><div class=pt-2><a href=/articles/building-a-high-available-messaging-system-a-step-by-step-cookbook/>Pulsar: Building a High Available Messaging System - A Step by Step CookBook</a></div><div class=pt-2>This guide will walk you step by step to deploy a Pulsar instance with one cluster but prepared ‚Ä¶</div></div></div></div></div><br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pulsar-neighborhood",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><div class="col-0 col-md-2"><nav class="navbar navbar-light mb-3"><div class=row><div class=col-12><h4>In this article</h4></div><div class="col-12 border-left border-primary pr-0"><nav id=TableOfContents><ul><li><a href=#an-all-in-one-messaging-system>An All In One Messaging System</a><ul><li></li></ul></li><li><a href=#what-is-apache-pulsar>What is Apache Pulsar?</a></li><li><a href=#tenant-implementation><strong>Tenant Implementation</strong></a></li><li><a href=#message-consumption><strong>Message Consumption</strong></a></li><li><a href=#message-acknowledgement><strong>Message Acknowledgement</strong></a></li><li><a href=#message-retention-and-time-to-live-ttl-policies><strong>Message Retention and Time To Live (TTL) Policies</strong></a></li><li><a href=#pulsar-arquitecture><strong>Pulsar Arquitecture</strong></a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div></nav><div class="row border border-primary rounded no-gutters"><div class="col-12 bg-primary p-1"><div class=text-secondary>&nbsp;Join Our Newsletter</div></div><div class=col-12><div class=ctct-inline-form data-form-id=7514f5a0-b12d-44b3-93bf-e16449e783ca style=padding:0></div></div></div></div></div></div></div><div class="sub-footer m-5"><div class=row><div class="col-12 text-center"><a href=https://github.com/pulsar-neighborhood/pulsar-neighborhood.github.io/blob/main/content/articles/Pulsar-Queuing-and-Streaming-An-All-in-One-Messaging-System.md target=_blank>Improve this page</a></div></div><div class="col-8 offset-2"><hr class="bg-primary text-primary"></div><div class="sub-footer-inner mt-2"><div><div class=mb-1>Pulsar Neighborhood</div><div><ul><li style=width:40px><a href=https://github.com/pulsar-neighborhood target=_blank><img src=/svg/github-brands.svg title="Pulsar Neighborhood on GitHub" class=img-fluid></a></li><li class="ml-3 mr-1" style=width:40px><a href=https://twitter.com/pulsar_neighbor target=_blank><img src=/svg/twitter-brands.svg title="Pulsar Neighborhood on Twitter" class=img-fluid></a></li><li style=width:40px><a href=https://www.youtube.com/c/ApachePulsarNeighborhood target=_blank><img src=/svg/youtube-brands.svg title="Pulsar Neighborhood on YouTube" class=img-fluid></a></li><li style=width:40px><a href=https://datastudio.google.com/reporting/743d9f31-c80f-4e60-b520-730631d3c250 target=_blank><img src=/png/google-analytics.png title="Pulsar Neighborhood analytics" class=img-fluid></a></li></ul></div></div><div class=p-5></div><div><div class=mb-1>Apache Pulsar</div><div><ul><li style=width:40px><a href=https://pulsar.apache.org target=_blank><img src=/png/pulsar-icon.jpg title="Apache Pulsar project home" class=img-fluid></a></li><li class="ml-3 mr-1" style=width:40px><a href=https://github.com/apache-pulsar target=_blank><img src=/svg/github-brands.svg title="Apache Pulsar on GitHub" class=img-fluid></a></li><li class=mr-1 style=width:40px><a href=https://twitter.com/Apache_Pulsar target=_blank><img src=/svg/twitter-brands.svg title="Apache Pulsar on Twitter" class=img-fluid></a></li><li class=mr-1 style=width:30px><a href=https://stackoverflow.com/questions/tagged/apache-pulsar target=_blank><img src=/svg/stack-overflow-brands.svg title="Apache Pulsar on Stackoverflow" class=img-fluid></a></li><li style=width:40px><a href=https://apache-pulsar.slack.com target=_blank><img src=/svg/slack-brands.svg title="Apache Pulsar slack channel" class=img-fluid></a></li></ul></div></div></div><div class="row text-center mb-3"><div class=col-12><a class="btn btn-info" href=https://pulsar.apache.org/community/ target=_blank>Join the Pulsar community</a></div></div><div class="row text-center"><div class="col-12 text-center"><div>Privacy Policy&nbsp;&nbsp;|&nbsp;&nbsp;Terms & Condition</div></div></div></div><script type=text/javascript src=/js/scripts.min.8efe3e711319c2d0a300a084134e3f3bedcb60dce21f1e0ef12767f654242b44.js></script>
<script type=text/javascript src=/js/filter.min.2ee09abe7fb6b636d1e7cc4506185cec9d630337089eff4daf0ccc27318f376e.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js integrity=sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF crossorigin=anonymous></script>
<script>var _ctct_m="310a7590faa964361197c4644ef1de96"</script><script id=signupScript src=//static.ctctcdn.com/js/signup-form-widget/current/signup-form-widget.min.js async defer></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8S9SD43SBH"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8S9SD43SBH")</script></body></html>